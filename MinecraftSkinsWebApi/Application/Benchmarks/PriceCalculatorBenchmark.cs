// ---------------------------------------------------------------------
// AUTOGENERATED HEADER: Added by add_file_headers.ps1 at 2026-02-16 09:45:02
// File: MinecraftSkinsWebApi\Application\Benchmarks\PriceCalculatorBenchmark.cs
// Purpose: TODO - fill file description
// ---------------------------------------------------------------------
using System.Threading;
using System.Threading.Tasks;
using BenchmarkDotNet.Attributes;
using Application.Services;
using Application.Services.Interfaces;

namespace Application.Benchmarks
{
    [MemoryDiagnoser]
    public class PriceCalculatorBenchmark
    {
        private PriceCalculator _calculator = null!;

        private sealed class FakeRateService : IGetRateService
        {
            private readonly decimal _rate;
            public FakeRateService(decimal rate) => _rate = rate;
            public Task<decimal> GetRateAsync(CancellationToken cancellationToken = default) => Task.FromResult(_rate);
        }

        [Params(2.5, 10, 100)]
        public double InputAmount { get; set; }

        [GlobalSetup]
        public void Setup()
        {
            var fake = new FakeRateService(60000m);
            _calculator = new PriceCalculator(fake);
        }

        [Benchmark]
        public decimal Calculate_FinalPrice()
        {
            return _calculator.CalculateFinalPriceAsync((decimal)InputAmount, CancellationToken.None).GetAwaiter().GetResult();
        }

        // Optional async benchmark to measure async overhead
        // [Benchmark]
        // public async Task<decimal> Calculate_FinalPrice_Async()
        // {
        //     return await _calculator.CalculateFinalPriceAsync((decimal)InputAmount, CancellationToken.None);
        // }
    }
}

